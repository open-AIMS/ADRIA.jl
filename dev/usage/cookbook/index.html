<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cookbook examples · ADRIA.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ADRIA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ADRIA.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../synopsis/">Synopsis</a></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../domain/">Loading a Domain</a></li><li><a class="tocitem" href="../scenario_generation/">Generating scenarios</a></li><li><a class="tocitem" href="../scenario_runs/">Running scenarios</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li class="is-active"><a class="tocitem" href>Cookbook examples</a><ul class="internal"><li><a class="tocitem" href="#Extracting-model-details"><span>Extracting model details</span></a></li><li><a class="tocitem" href="#Generating-and-running-scenarios"><span>Generating and running scenarios</span></a></li><li><a class="tocitem" href="#Intervention-location-selection"><span>Intervention location selection</span></a></li><li><a class="tocitem" href="#Intervention-location-selection-summary-functions"><span>Intervention location selection - summary functions</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../dMCDA/">Dynamic Multi-Criteria Decision Analysis</a></li><li><span class="tocitem">Architecture</span><ul><li><a class="tocitem" href="../../architecture/architecture/">Architectural overview</a></li><li><a class="tocitem" href="../../architecture/domain_and_resultsets/">Inputs and Outputs</a></li></ul></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../../development/development_setup/">Development setup</a></li><li><a class="tocitem" href="../../development/metrics/">Contributing a metric</a></li><li><a class="tocitem" href="../../development/release_guide/">Release Guide</a></li><li><a class="tocitem" href="../../development/building_docs/">Building Documentation</a></li></ul></li><li><a class="tocitem" href="../../API/">ADRIA API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Usage</a></li><li class="is-active"><a href>Cookbook examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cookbook examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/open-AIMS/ADRIA.jl/blob/main/docs/src/usage/cookbook.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Cookbook-examples"><a class="docs-heading-anchor" href="#Cookbook-examples">Cookbook examples</a><a id="Cookbook-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Cookbook-examples" title="Permalink"></a></h1><h2 id="Extracting-model-details"><a class="docs-heading-anchor" href="#Extracting-model-details">Extracting model details</a><a id="Extracting-model-details-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-model-details" title="Permalink"></a></h2><p>Example showcasing how to extract model details, such as:</p><ul><li>the model parameter table</li><li>model specification</li></ul><p>and more specific information/data from the above.</p><pre><code class="language-julia hljs">using DataFrames
using ADRIA


# Loading a dataset for a study area (a &quot;domain&quot;)
data_pkg = &quot;./Example_domain&quot;
dom = ADRIA.load_domain(data_pkg, 45)

# Get current parameter table (fieldnames and their values)
param_df = ADRIA.param_table(dom)

# Get model specification with lower/upper bounds separated
model_spec = ADRIA.model_spec(dom)

# Export model specification to CSV
ADRIA.model_spec(dom, &quot;model_spec.csv&quot;)


# Get parameter details

## Parameter names
p_names = dom.model[:fieldname]

## Current values
p_vals = dom.model[:val]

## ADRIA parameter types
p_types = dom.model[:ptype]

## Parameter bounds (for e.g., to pass into a sampler or optimizer)
## Note: ADRIA integer parameter bounds are set such that ℓ ≤ x ≤ u+1,
## where ℓ is the lower bound and u is the upper bound.
## This is because `floor(x)` is assigned with `update_params!()`.
## Instances where ℓ := x := u indicate uncertain parameters that
## are nevertheless assumed to be constant.
p_bounds = dom.model[:bounds]

## Component groups
p_groups = dom.model[:component]

## All of above as a DataFrame
model_spec = DataFrame(dom.model)


# Get DataFrame of parameter information for a specific sub-component (Intervention, Criteria, Coral)
ADRIA.component_params(dom.model, Intervention)</code></pre><h2 id="Generating-and-running-scenarios"><a class="docs-heading-anchor" href="#Generating-and-running-scenarios">Generating and running scenarios</a><a id="Generating-and-running-scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-and-running-scenarios" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ADRIA


# Loading data package
dom = ADRIA.load_domain(&quot;Example_domain&quot;)

# Creating 128 scenarios based on parameter bounds using the Sobol&#39; method
scens = ADRIA.sample(dom, 128)

# Can also use other samplers
# using Surrogates.QuasiMonteCarlo
# scens = ADRIA.sample(dom, 100, LatinHypercubeSample())

# Can also sample counterfactuals (scenarios with no interventions)
# or scenarios with guided interventions only
# s = ADRIA.sample_cf(dom, 32)
# s = ADRIA.sample_guided(dom, 32)

# Can also load previously generated scenarios
# p_df = ADRIA.load_scenarios(dom, joinpath(here, &quot;example_scenarios.csv&quot;))

# Batch run scenarios. Returns a ResultSet.
# Setting up and running scenarios
rs = ADRIA.run_scenarios(dom, p_df, &quot;45&quot;)

# Multiple RCPs can be specified, so long as RCP-specific data is available.
# rs = ADRIA.run_scenarios(dom, p_df, [&quot;45&quot;, &quot;60&quot;])

# Single scenario run (returns NamedTuple of results for a single environmental/intervention scenario).
# See documentation for more detail.
# scenario_id = 1
# result = ADRIA.run_scenario(domain::Domain, scenario_id, param_df::DataFrameRow)

# switch_RCPs!(domain, &quot;45&quot;)
# res1 = ADRIA.run_scenario(domain, scens[1, :])
# res2 = ADRIA.run_scenario(domain, scens[2, :])
# res3 = ADRIA.run_scenario(domain, scens[3, :], &quot;60&quot;)  # run for a different RCP

# The location of the outputs stored on disk
@info ADRIA.store_name(rs)
# &quot;Example_domain__RCPs45__2022-10-19_12_01_26_965&quot;

@info ADRIA.result_location(rs)
# &quot;[some location]/Example_domain__RCPs45__2022-10-19_12_01_26_965&quot;

# Can also load results using a path to the stored result set.
# rs = ADRIA.load_results(&quot;path to result set&quot;)

# Specific metrics found in the `metrics` submodule.
# tac = ADRIA.metrics.total_absolute_cover(rs)</code></pre><h2 id="Intervention-location-selection"><a class="docs-heading-anchor" href="#Intervention-location-selection">Intervention location selection</a><a id="Intervention-location-selection-1"></a><a class="docs-heading-anchor-permalink" href="#Intervention-location-selection" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ADRIA
using ADRIA: rank_locations


dom = ADRIA.load_domain(&quot;path to domain&quot;, &quot;45&quot;)
scens = ADRIA.sample_site_selection(dom, 8)

# Area of seeded corals in m^2
area_to_seed = 962.11

# Initial coral cover matching number of criteria samples (size = (no. criteria scens, no. of sites)).
sum_cover = repeat(sum(dom.init_coral_cover; dims=1), size(scens, 1))

# Use rank_locations to get ranks
ranks = rank_locations(dom, scens, sum_cover, area_to_seed)</code></pre><h2 id="Intervention-location-selection-summary-functions"><a class="docs-heading-anchor" href="#Intervention-location-selection-summary-functions">Intervention location selection - summary functions</a><a id="Intervention-location-selection-summary-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Intervention-location-selection-summary-functions" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ADRIA
using ADRIA:
    rank_locations,
    ranks_to_frequencies,
    location_selection_frequencies,
    selection_score
using DataFrames
using Statistics, StatsBase

# Load data package
dom = ADRIA.load_domain(&quot;path to Domain files&quot;, &quot;RCP&quot;)

# Select locations for interventions without any model runs
scens = ADRIA.sample_site_selection(dom, 8)  # Get site selection scenario dataframe.

# Area of seeded corals in m^2
area_to_seed = 962.11

# Initial coral cover matching number of criteria samples
sum_cover = repeat(sum(dom.init_coral_cover; dims=1), size(scens, 1))

# Use rank_locations to get ranks
ranks = rank_locations(dom, scens, sum_cover, area_to_seed)

# Get frequencies with which each site is selected for each rank for set of stand alone
# location selections
rank_freq = ranks_to_frequencies(ranks[intervention=1])

# Calculate rank aggregations
# Get location selection freqencies for set of standalone location selections
location_selection_frequency = location_selection_frequencies(ranks[intervention=1])

# Get summed inverse rank for set of standalone location selections
# Measure of magnitude and frequency of high rank
sel_score = selection_score(ranks[intervention=1])

# Use aggregation function within rank_locations to get direct output
# To get rank frequencies:
rank_frequencies_seed = rank_locations(
    dom, scens, sum_cover, area_to_seed, ranks_to_frequencies, 1
)
rank_frequencies_seed = rank_locations(
    dom, scens, sum_cover, area_to_seed, location_selection_frequencies, 1
)
rank_frequencies_seed = rank_locations(
    dom, scens, sum_cover, area_to_seed, selection_score, 1
)

# Example using ADRIA runs
scens = ADRIA.sample(dom, 8)
rs = ADRIA.run_scenarios(dom, scens, &quot;45&quot;)

# Get frequencies with which each site was selected for each rank for a set of runs
rank_freq = ranks_to_frequencies(rs.ranks[intervention=1])  # with timesteps not aggregated

# With timesteps aggregated
rank_freq = ranks_to_frequencies(
    rs.ranks[intervention=1];
    agg_func=x -&gt; dropdims(sum(x; dims=:timesteps); dims=:timesteps),
)

# Get selection frequencies for set of runs
selection_freq = location_selection_frequencies(rs.ranks[intervention=1])

# Get selection frequencies over time for unguided runs only
unguided_freq = location_selection_frequencies(
    rs.seed_log[scenarios=findall(scens.guided .&gt;= 1)]
)

# Get selection score for set of runs
# Measure of magnitude and frequency of high rank
sel_score = selection_score(rs.ranks[intervention=1])

# Get selection score for locations over time
sel_score = selection_score(rs.ranks[intervention=1]; dims=[:scenarios])</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../analysis/">« Analysis</a><a class="docs-footer-nextpage" href="../../dMCDA/">Dynamic Multi-Criteria Decision Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 1 February 2024 05:47">Thursday 1 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
